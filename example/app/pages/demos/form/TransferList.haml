:ruby
  Fieldset = import("/components/Form/Fieldset")
  Button = import("/components/Form/Button")
  Input = import("/components/Form/Input")
  Select = import("/components/Form/Select")
  Checkbox = import("/components/Form/Checkbox")

  ITEMS = %w[ dream friendly chief potato irritate creature pastoral selective lyrical fire seal righteous ]

  def initialize
    @left = ITEMS.size.times.to_a
    @right = []
  end

  def get_selected(form_data, prefix)
    form_data
      .select { |k, v| k.to_s.start_with?(prefix) && v == "on" }
      .keys
      .map { _1.to_s.split("-").last.to_i }
  end

  def handle_submit(e)
    case e
    in { submitter: { name: "action", value: "move_all_left" } }
      @left += @right
      @right = []
    in { submitter: { name: "action", value: "move_all_right" } }
      @right += @left
      @left = []
    in { submitter: { name: "action", value: "move_selected_left" }, target: { formData: } }
      selected = get_selected(formData, "right-")

      @left |= selected
      @right -= selected
    in { submitter: { name: "action", value: "move_selected_right" }, target: { formData: } }
      selected = get_selected(formData, "left-")

      @right |= selected
      @left -= selected
    else
      {}
    end
  end

%Fieldset
  %legend Transfer list
  %form(onsubmit=handle_submit)
    %ul
      = @left.map do |item|
        %li[item]
          %Checkbox{
            label: ITEMS[item],
            name: "left-#{item}",
            group_class: Styles[:group],
          }

    .buttons
      %button(type="submit" name="action" value="move_all_left" title="Move all left") ⟪
      %button(type="submit" name="action" value="move_selected_left" title="Move selected left") ⟨
      %button(type="submit" name="action" value="move_all_right" title="Move all right") ⟫
      %button(type="submit" name="action" value="move_selected_right" title="Move selected right") ⟩

    %ul
      = @right.map do |item|
        %li[item]
          %Checkbox{
            label: ITEMS[item],
            name: "right-#{item}",
            group_class: Styles[:group],
          }
