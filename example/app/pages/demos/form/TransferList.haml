:ruby
  Heading = require("/app/components/Layout/Heading")
  Fieldset = require("/app/components/Form/Fieldset")
  Button = require("/app/components/Form/Button")
  Input = require("/app/components/Form/Input")
  Select = require("/app/components/Form/Select")
  Checkbox = require("/app/components/Form/Checkbox")

  ITEMS = %w[ dream friendly chief potato irritate creature pastoral selective lyrical fire seal righteous ]

  def self.get_initial_state(**)
    {
      left: ITEMS.size.times.to_a,
      right: [],
    }
  end

  def get_selected(form_data, prefix)
    form_data
      .select { |k, v| k.start_with?(prefix) && v == "on" }
      .keys
      .map { _1.split("-").last.to_i }
  end

  def handle_submit(e)
    update do |state|
      case e["formData"]["action"]
      when "move_all_left"
        { left: state[:left] + state[:right], right: [] }
      when "move_all_right"
        { left: [], right: state[:right] + state[:left] }
      when "move_selected_left"
        selected = get_selected(e["formData"], "right-")

        {
          left: state[:left].union(selected),
          right: state[:right].difference(selected),
        }
      when "move_selected_right"
        selected = get_selected(e["formData"], "left-")

        {
          left: state[:left].difference(selected),
          right: state[:right].union(selected),
        }
      else
        {}
      end
    end
  end

%div
  %Heading(level=2) Transfer list

  %form.container{on_submit: handler(:handle_submit)}
    %ul.list
      = state[:left].map do |item|
        %li.item(key=item)
          %Checkbox{
            label: ITEMS[item],
            name: "left=#{item}",
            group_class: styles[:group],
          }
    .buttons
      %button.button(type="submit" name="action" value="move_all_left" title="Move all left") ⟪
      %button.button(type="submit" name="action" value="move_selected_left" title="Move selected left") ⟨
      %button.button(type="submit" name="action" value="move_all_right" title="Move all right") ⟫
      %button.button(type="submit" name="action" value="move_selected_right" title="Move selected right") ⟩

    %ul.list
      = state[:right].map do |item|
        %li.item(key=item)
          %Checkbox{
            label: ITEMS[item],
            name: "right=#{item}",
            group_class: styles[:group],
          }
